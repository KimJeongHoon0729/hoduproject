<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="pension">
	
	<select id="likeList" resultType="com.woori.domain.PensionVO">
		SELECT p.pensionName, p.img_pension, p.region, p.address, p.message, AVG(r.rating) AS avg_rating
		FROM pension p
		LEFT JOIN review r ON p.pensionName = r.pensionName 
		WHERE p.region = #{region}
		GROUP BY p.pensionName
		ORDER BY avg_rating DESC;
	</select>
	
	<select id="moneyList" resultType="com.woori.domain.PensionVO">
		SELECT p.pensionName, p.img_pension, p.region, p.address, p.message, Min(r.price) AS min_price 
		FROM pension p
		LEFT JOIN room r ON p.pensionName = r.pensionName 
		WHERE p.region = '경기'
		GROUP BY p.pensionName
		ORDER BY min_price DESC;
	</select>
	
	<!-- 리뷰 평점 평균 -->
	<select id="AvgRating" resultType="String">
		select round(avg(rating),2) from review where pensionName = #{pensionName} 
	</select>
	
	<!-- 가격 최소 -->
	<select id="MinPrice" resultType="String">
		select min(price) from room where pensionName = #{pensionName} 
	</select>
	
	<!-- 객실 등록 -->
	<insert id="roomRegister">
		INSERT INTO room(room_idx, partnerId, roomName, price, dogSize,  
			 dogNum, peopleNum, img_room, message_room, pensionName)  
			VALUES(#{room_idx},#{partnerId},#{roomName},#{price},#{dogSize}, #{dogNum},  
			#{peopleNum}, #{img_room}, #{message_room}, #{pensionName})
	</insert>
	<!-- 펜션 세부 사항 출력 -->
	<select id="RoomList" resultType="com.woori.domain.RoomVO" parameterType="String">
		select   *   from  
		room   
		where   
		pensionName = #{pensionName} 
	</select>
	
	<!-- 펜션 등록 -->
	<insert id="pensionRegister">
		insert into pension (partnerId, region, pensionName, address, message)  
		values (#{partnerId}, #{region}, #{pensionName}, #{address}, #{message})
	</insert>
</mapper>